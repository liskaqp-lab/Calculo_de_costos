<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Precios - Fotograf√≠a Clarity</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .card-shadow { box-shadow: 0 8px 32px rgba(37, 36, 30, 0.15); }
        .gradient-bg { background: linear-gradient(135deg, #65C1C0 0%, #6767AD 100%); }
        .dark-gradient { background: linear-gradient(135deg, #25241E 0%, #6767AD 100%); }
        .orange-gradient { background: linear-gradient(135deg, #EA5F0B 0%, #F4BA3B 100%); }
        .teal-accent { background: linear-gradient(135deg, #65C1C0 0%, #6767AD 100%); }
        
        .estrategia-activa {
            transform: scale(1.02);
            box-shadow: 0 8px 25px rgba(103, 103, 173, 0.4);
            border-color: #6767AD !important;
        }
        
        .estrategia-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(37, 36, 30, 0.2);
        }

        .primary-text { color: #25241E; }
        .secondary-text { color: #6767AD; }
        .accent-text { color: #EA5F0B; }
        .success-text { color: #65C1C0; }
        .warning-text { color: #F4BA3B; }

        .bg-primary { background-color: #25241E; }
        .bg-secondary { background-color: #6767AD; }
        .bg-accent { background-color: #EA5F0B; }
        .bg-success { background-color: #65C1C0; }
        .bg-warning { background-color: #F4BA3B; }

        .border-primary { border-color: #25241E; }
        .border-secondary { border-color: #6767AD; }
        .border-accent { border-color: #EA5F0B; }
        .border-success { border-color: #65C1C0; }
        .border-warning { border-color: #F4BA3B; }

        .hover-primary:hover { background-color: #25241E; color: #FFFFFF; }
        .hover-secondary:hover { background-color: #6767AD; color: #FFFFFF; }
        .hover-accent:hover { background-color: #EA5F0B; color: #FFFFFF; }
        .hover-success:hover { background-color: #65C1C0; color: #FFFFFF; }
        .hover-warning:hover { background-color: #F4BA3B; color: #25241E; }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold primary-text mb-4">Calculadora de Precios Universal</h1>
            <p class="text-xl text-white">Para cualquier producto o servicio</p>
            <p class="text-white opacity-90 mt-2">Calcula costos, precios y punto de equilibrio de tu negocio</p>
        </div>

        <!-- Configuraci√≥n General: Moneda e Impuestos -->
        <div class="bg-white rounded-2xl p-8 card-shadow mb-8">
            <div class="text-center mb-8">
                <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-blue-100 to-purple-100 rounded-full mb-4">
                    <span class="text-3xl">‚öôÔ∏è</span>
                </div>
                <h2 class="text-2xl font-bold primary-text mb-2">Configuraci√≥n General</h2>
                <p class="secondary-text">Establece la moneda de trabajo e impuestos aplicables a tu negocio</p>
            </div>

            <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
                <!-- Selector de Moneda -->
                <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-200">
                    <div class="flex items-center mb-4">
                        <div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center mr-3">
                            <span class="text-white text-lg">üí±</span>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold primary-text">Moneda de Trabajo</h3>
                            <p class="text-sm text-blue-600">Selecciona tu moneda principal</p>
                        </div>
                    </div>
                    <select id="monedaSelector" class="w-full p-4 border-2 border-blue-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-center font-semibold primary-text text-lg bg-white shadow-sm transition-all" onchange="cambiarMoneda()">
                        <option value="Q">üá¨üáπ Quetzales (Q)</option>
                        <option value="$">üá∫üá∏ D√≥lares ($)</option>
                        <option value="‚Ç¨">üá™üá∫ Euros (‚Ç¨)</option>
                    </select>
                </div>

                <!-- Configuraci√≥n de Impuestos -->
                <div class="bg-gradient-to-br from-amber-50 to-orange-50 rounded-xl p-6 border border-amber-200">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-amber-500 rounded-lg flex items-center justify-center mr-3">
                                <span class="text-white text-lg">üè∑Ô∏è</span>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold primary-text">Impuestos</h3>
                                <p class="text-sm text-amber-600">Configura los impuestos aplicables</p>
                            </div>
                        </div>
                        <button id="toggleFormularioImpuestos" onclick="toggleFormularioImpuestos()" class="px-4 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600 transition-colors text-sm font-medium shadow-sm">
                            + Agregar
                        </button>
                    </div>
                    
                    <!-- Formulario para agregar impuesto (colapsable) -->
                    <div id="formularioImpuestos" class="hidden bg-white p-4 rounded-lg border border-amber-300 mb-4 shadow-sm">
                        <p class="text-sm text-amber-700 mb-4 font-medium">üí° Ejemplos: IVA Espa√±a 21%, GST Canad√° 5%, ISR M√©xico 16%</p>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-amber-800 mb-2">Nombre del impuesto</label>
                                <input type="text" id="nombreImpuestoPersonalizado" placeholder="Ej: IVA, GST, ISR" class="w-full p-3 border border-amber-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500">
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-amber-800 mb-2">Porcentaje (%)</label>
                                    <div class="relative">
                                        <input type="number" id="porcentajeImpuestoPersonalizado" placeholder="0.0" step="0.1" min="0" class="w-full pl-3 pr-8 py-3 border border-amber-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500">
                                        <span class="absolute right-3 top-3 text-amber-600 font-semibold">%</span>
                                    </div>
                                </div>
                                <div class="flex items-end">
                                    <button onclick="agregarImpuestoPersonalizado()" class="w-full p-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors font-medium">
                                        ‚úì Confirmar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Lista de impuestos (visible solo si hay impuestos) -->
                    <div id="listaImpuestosPersonalizados" class="space-y-2 mb-4 hidden">
                        <!-- Los impuestos se agregar√°n aqu√≠ din√°micamente -->
                    </div>

                    <!-- Resumen de impuestos totales (siempre visible) -->
                    <div id="resumenImpuestosPersonalizados" class="bg-gradient-to-r from-teal-500 to-blue-500 text-white p-4 rounded-lg shadow-md">
                        <div class="flex justify-between items-center">
                            <div class="flex items-center">
                                <span class="text-2xl mr-2">üìä</span>
                                <span class="font-semibold">Total de Impuestos</span>
                            </div>
                            <span id="totalImpuestosPersonalizados" class="text-2xl font-bold">0.0%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Producto 1 (Base - No eliminable) -->
        <div class="bg-white rounded-3xl p-8 border-2 border-success card-shadow mb-8 producto-completo" data-producto="1">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold primary-text mb-2">üì¶ PRODUCTO 1</h2>
                <p class="secondary-text text-lg">Configuraci√≥n completa: costos, precios y an√°lisis</p>
                <p class="text-sm text-gray-500 mt-2">Este producto base no puede eliminarse</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <!-- Inversi√≥n Inicial -->
                <div class="bg-gray-50 rounded-2xl p-6 h-full">
                    <div class="flex items-center mb-4">
                        <span class="text-2xl mr-3">üí∞</span>
                        <div>
                            <h4 class="text-lg font-bold primary-text">Inversi√≥n Inicial</h4>
                            <p class="secondary-text text-sm">Gastos necesarios para arrancar</p>
                        </div>
                    </div>
                    
                    <div class="inversion-items space-y-3 mb-4">
                        <div class="flex gap-3 items-center">
                            <input type="text" placeholder="Concepto" value="Equipo principal" class="flex-1 p-2 border border-success rounded-lg focus:ring-2 focus:ring-secondary text-sm">
                            <div class="relative w-28">
                                <span class="absolute left-2 top-2 secondary-text font-semibold text-xs moneda">Q</span>
                                <input type="number" placeholder="0" value="15000" class="w-full pl-6 pr-2 py-2 border border-success rounded-lg focus:ring-2 focus:ring-secondary text-sm" onchange="calcularInversion()">
                            </div>
                            <button onclick="eliminarItem(this)" class="accent-text hover:bg-accent hover:text-white p-1 rounded transition-colors">üóëÔ∏è</button>
                        </div>
                        <div class="flex gap-3 items-center">
                            <input type="text" placeholder="Concepto" value="Mobiliario y decoraci√≥n" class="flex-1 p-2 border border-success rounded-lg focus:ring-2 focus:ring-secondary text-sm">
                            <div class="relative w-28">
                                <span class="absolute left-2 top-2 secondary-text font-semibold text-xs moneda">Q</span>
                                <input type="number" placeholder="0" value="8000" class="w-full pl-6 pr-2 py-2 border border-success rounded-lg focus:ring-2 focus:ring-secondary text-sm" onchange="calcularInversion()">
                            </div>
                            <button onclick="eliminarItem(this)" class="accent-text hover:bg-accent hover:text-white p-1 rounded transition-colors">üóëÔ∏è</button>
                        </div>
                    </div>
                    
                    <button onclick="agregarInversion(this)" class="w-full p-2 bg-success text-white rounded-lg hover-secondary transition-colors mb-3 font-medium text-sm">
                        + Agregar costo inicial
                    </button>
                    
                    <div class="dark-gradient text-white p-3 rounded-lg text-center">
                        <p class="text-sm font-semibold">Total Inversi√≥n</p>
                        <p class="total-inversion text-xl font-bold"><span class="moneda">Q</span> 23,000</p>
                    </div>
                </div>

                <!-- Costos Mensuales -->
                <div class="bg-gray-50 rounded-2xl p-6 h-full">
                    <div class="flex items-center mb-4">
                        <span class="text-2xl mr-3">üìä</span>
                        <div>
                            <h4 class="text-lg font-bold primary-text">Costos Mensuales</h4>
                            <p class="secondary-text text-sm">Gastos fijos y variables</p>
                        </div>
                    </div>

                    <!-- Costos Fijos -->
                    <div class="mb-4">
                        <h5 class="text-sm font-semibold secondary-text mb-2">Costos Fijos</h5>
                        <div class="costos-fijos space-y-2 mb-3">
                            <div class="flex gap-2 items-center">
                                <input type="text" placeholder="Concepto" value="Alquiler/Renta" class="flex-1 p-2 border border-success rounded-lg focus:ring-2 focus:ring-secondary text-xs">
                                <div class="relative w-20">
                                    <span class="absolute left-1 top-2 secondary-text font-semibold text-xs moneda">Q</span>
                                    <input type="number" placeholder="0" value="3000" class="w-full pl-4 pr-1 py-2 border border-success rounded-lg focus:ring-2 focus:ring-secondary text-xs" onchange="calcularCostos()">
                                </div>
                                <button onclick="eliminarItem(this)" class="accent-text hover:bg-accent hover:text-white text-xs p-1 rounded">üóëÔ∏è</button>
                            </div>
                            <div class="flex gap-2 items-center">
                                <input type="text" placeholder="Concepto" value="Servicios b√°sicos" class="flex-1 p-2 border border-success rounded-lg focus:ring-2 focus:ring-secondary text-xs">
                                <div class="relative w-20">
                                    <span class="absolute left-1 top-2 secondary-text font-semibold text-xs moneda">Q</span>
                                    <input type="number" placeholder="0" value="800" class="w-full pl-4 pr-1 py-2 border border-success rounded-lg focus:ring-2 focus:ring-secondary text-xs" onchange="calcularCostos()">
                                </div>
                                <button onclick="eliminarItem(this)" class="accent-text hover:bg-accent hover:text-white text-xs p-1 rounded">üóëÔ∏è</button>
                            </div>
                        </div>
                        <button onclick="agregarCostoFijo(this)" class="w-full p-2 bg-blue-100 text-blue-800 rounded-lg hover:bg-blue-200 transition-colors text-xs mb-2">+ Agregar fijo</button>
                        <div class="p-2 bg-blue-50 rounded-lg">
                            <p class="font-semibold text-blue-800 text-xs">Total Fijos: <span class="total-fijos"><span class="moneda">Q</span> 3,800</span></p>
                        </div>
                    </div>

                    <!-- Costos Variables -->
                    <div class="mb-4">
                        <h5 class="text-sm font-semibold secondary-text mb-2">Costos Variables</h5>
                        <div class="costos-variables space-y-2 mb-3">
                            <div class="flex gap-2 items-center">
                                <input type="text" placeholder="Concepto" value="Materiales por unidad" class="flex-1 p-2 border border-success rounded-lg focus:ring-2 focus:ring-secondary text-xs">
                                <div class="relative w-20">
                                    <span class="absolute left-1 top-2 secondary-text font-semibold text-xs moneda">Q</span>
                                    <input type="number" placeholder="0" value="200" class="w-full pl-4 pr-1 py-2 border border-success rounded-lg focus:ring-2 focus:ring-secondary text-xs" onchange="calcularCostos()">
                                </div>
                                <button onclick="eliminarItem(this)" class="accent-text hover:bg-accent hover:text-white text-xs p-1 rounded">üóëÔ∏è</button>
                            </div>
                        </div>
                        <button onclick="agregarCostoVariable(this)" class="w-full p-2 bg-purple-100 text-purple-800 rounded-lg hover:bg-purple-200 transition-colors text-xs mb-2">+ Agregar variable</button>
                        <div class="p-2 bg-purple-50 rounded-lg">
                            <p class="font-semibold text-purple-800 text-xs">Total Variables: <span class="total-variables"><span class="moneda">Q</span> 200</span></p>
                        </div>
                    </div>

                    <!-- Horas de Trabajo -->
                    <div class="border-t border-gray-300 pt-4">
                        <h5 class="text-sm font-semibold secondary-text mb-2">‚è∞ Horas de Trabajo</h5>
                        <div class="grid grid-cols-2 gap-2 mb-3">
                            <div>
                                <input type="number" placeholder="Horas/d√≠a" min="1" max="24" class="horas-por-dia w-full p-2 border border-success rounded-lg focus:ring-2 focus:ring-secondary text-xs" onchange="calcularHorasTrabajo()">
                            </div>
                            <div>
                                <input type="number" placeholder="D√≠as/mes" min="1" max="31" class="dias-por-mes w-full p-2 border border-success rounded-lg focus:ring-2 focus:ring-secondary text-xs" onchange="calcularHorasTrabajo()">
                            </div>
                            <div>
                                <input type="number" placeholder="Horas proyecto" min="1" class="horas-proyecto w-full p-2 border border-success rounded-lg focus:ring-2 focus:ring-secondary text-xs" onchange="calcularHorasTrabajo()">
                            </div>
                            <div class="relative">
                                <span class="absolute left-1 top-2 secondary-text font-semibold text-xs moneda">Q</span>
                                <input type="number" placeholder="Honorarios/h" min="0" class="honorarios-hora w-full pl-4 pr-1 py-2 border border-success rounded-lg focus:ring-2 focus:ring-secondary text-xs" onchange="calcularHorasTrabajo()">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <div class="bg-orange-50 p-2 rounded-lg text-center">
                                <p class="text-xs text-orange-700">Horas/mes</p>
                                <p class="total-horas-mensuales text-sm font-bold text-orange-800">0</p>
                            </div>
                            <div class="bg-green-50 p-2 rounded-lg text-center">
                                <p class="text-xs text-green-700">Honorarios</p>
                                <p class="costo-honorarios-mensuales text-sm font-bold text-green-800"><span class="moneda">Q</span> 0</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configuraci√≥n del Producto -->
            <div class="bg-gray-50 rounded-2xl p-6 mb-8">
                <div class="flex items-center mb-4">
                    <span class="text-2xl mr-3">üõçÔ∏è</span>
                    <div>
                        <h4 class="text-lg font-bold primary-text">Configuraci√≥n</h4>
                        <p class="secondary-text text-sm">Precio y producci√≥n</p>
                    </div>
                </div>
                
                <div class="space-y-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium secondary-text mb-2">Nombre del producto</label>
                        <input type="text" placeholder="Ej: Producto nuevo" value="Producto ejemplo" class="w-full p-3 border border-success rounded-lg focus:ring-2 focus:ring-secondary">
                    </div>
                    <div>
                        <label class="block text-sm font-medium secondary-text mb-2">Costo de producci√≥n</label>
                        <div class="relative">
                            <span class="absolute left-3 top-3 secondary-text font-semibold moneda">Q</span>
                            <input type="number" placeholder="0" value="500" class="costo-produccion w-full pl-8 pr-3 py-3 border border-success rounded-lg focus:ring-2 focus:ring-secondary bg-gray-100" readonly>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium secondary-text mb-2">Precio de venta deseado</label>
                        <div class="relative">
                            <span class="absolute left-3 top-3 secondary-text font-semibold moneda">Q</span>
                            <input type="number" placeholder="0" value="1000" class="precio-venta w-full pl-8 pr-3 py-3 border border-success rounded-lg focus:ring-2 focus:ring-secondary" onchange="calcularProductos()">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium secondary-text mb-2">Unidades producidas/mes</label>
                        <input type="number" placeholder="0" value="10" min="1" class="unidades-mensuales w-full p-3 border border-success rounded-lg focus:ring-2 focus:ring-secondary" onchange="calcularProductos()">
                    </div>
                </div>
            </div>
            
            <!-- Resultados del producto -->
            <div class="grid grid-cols-4 gap-3 mt-8">
                <div class="bg-blue-50 p-3 rounded-lg text-center">
                    <p class="text-xs text-blue-700">Costo total</p>
                    <p class="costo-total text-sm font-bold text-blue-800"><span class="moneda">Q</span> 538</p>
                </div>
                <div class="bg-red-50 p-3 rounded-lg text-center">
                    <p class="text-xs text-red-700">Impuestos</p>
                    <p class="total-impuestos text-sm font-bold text-red-800"><span class="moneda">Q</span> 220</p>
                </div>
                <div class="bg-green-50 p-3 rounded-lg text-center">
                    <p class="text-xs text-green-700">Ganancia</p>
                    <p class="ganancia-neta text-sm font-bold text-green-800"><span class="moneda">Q</span> 242</p>
                </div>
                <div class="bg-purple-50 p-3 rounded-lg text-center">
                    <p class="text-xs text-purple-700">Margen</p>
                    <p class="margen-porcentaje text-sm font-bold text-purple-800">24.2%</p>
                </div>
            </div>
        </div>

        <!-- Contenedor de Productos Adicionales -->
        <div id="productosCompletosContainer" class="space-y-8">
            <!-- Los productos adicionales se agregar√°n aqu√≠ -->
        </div>

        <!-- Bot√≥n para agregar m√°s productos -->
        <div class="text-center mb-8" style="margin-top: 30px;">
            <button onclick="agregarProductoCompleto()" class="px-8 py-4 orange-gradient text-white rounded-2xl hover:shadow-xl transition-all duration-300 font-bold text-lg shadow-lg transform hover:scale-105">
                + Agregar Nuevo Producto
            </button>
            <p class="text-white opacity-90 mt-2">Cada producto incluye su inversi√≥n inicial, costos mensuales y configuraci√≥n</p>
        </div>



        <!-- Punto de Equilibrio -->
        <div class="bg-white rounded-2xl p-8 card-shadow mb-8">
                <div class="flex items-center mb-6">
                    <span class="text-3xl mr-3">‚öñÔ∏è</span>
                    <div>
                        <h2 class="text-2xl font-bold primary-text">Punto de Equilibrio</h2>
                        <p class="secondary-text">An√°lisis autom√°tico basado en tus costos y productos</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-lg font-semibold text-amber-800 mb-4">üìä Datos Calculados Autom√°ticamente</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-amber-700 mb-2">Costos fijos mensuales</label>
                                <div class="w-full p-3 bg-gray-100 border border-amber-200 rounded-lg text-amber-800 font-semibold">
                                    <span class="moneda">Q</span> <span id="costosFijosEquilibrioDisplay">3,800</span>
                                </div>
                                <p class="text-xs text-amber-600 mt-1">Calculado desde tus costos fijos + amortizaci√≥n</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-amber-700 mb-2">Precio promedio por producto/servicio</label>
                                <div class="w-full p-3 bg-gray-100 border border-amber-200 rounded-lg text-amber-800 font-semibold">
                                    <span class="moneda">Q</span> <span id="precioPromedioServicioDisplay">1,000</span>
                                </div>
                                <p class="text-xs text-amber-600 mt-1">Promedio ponderado de tus productos</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-amber-700 mb-2">Costo variable promedio por unidad</label>
                                <div class="w-full p-3 bg-gray-100 border border-amber-200 rounded-lg text-amber-800 font-semibold">
                                    <span class="moneda">Q</span> <span id="costoVariableServicioDisplay">200</span>
                                </div>
                                <p class="text-xs text-amber-600 mt-1">Promedio de costos variables por unidad</p>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-lg font-semibold text-amber-800 mb-4">üìà Resultados del An√°lisis</h3>
                        <div class="space-y-4">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <p class="text-sm text-blue-700">Margen de contribuci√≥n promedio</p>
                                <p id="margenContribucion" class="text-2xl font-bold text-blue-800"><span class="moneda">Q</span> 800</p>
                                <p class="text-xs text-blue-600 mt-1">Precio - Costo Variable</p>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg">
                                <p class="text-sm text-green-700">Unidades necesarias para equilibrio</p>
                                <p id="serviciosEquilibrio" class="text-2xl font-bold text-green-800">5 unidades/mes</p>
                                <p class="text-xs text-green-600 mt-1">Para cubrir todos los costos fijos</p>
                            </div>
                            <div class="chocolate-gradient text-white p-4 rounded-lg">
                                <p class="text-sm opacity-90">Ingresos m√≠nimos mensuales</p>
                                <p id="ingresosMinimos" class="text-2xl font-bold"><span class="moneda">Q</span> 4,750</p>
                                <p class="text-xs opacity-75 mt-1">Ventas m√≠nimas para no perder dinero</p>
                            </div>
                        </div>
                    </div>
                </div>


            </div>

        <!-- Cotizaci√≥n -->
        <div class="bg-white rounded-2xl p-8 card-shadow mb-8">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center">
                        <span class="text-3xl mr-3">üìã</span>
                        <div>
                            <h2 class="text-2xl font-bold primary-text">Cotizaci√≥n</h2>
                            <p class="secondary-text">Formato de factura para presentar a clientes</p>
                        </div>
                    </div>
                    <div>
                        <button onclick="imprimirCotizacion()" class="px-6 py-3 bg-accent text-white rounded-lg hover-warning transition-colors font-medium flex items-center gap-2">
                            üñ®Ô∏è Imprimir Cotizaci√≥n
                        </button>
                    </div>
                </div>

                <!-- Estrategias de Precio -->
                <div class="mb-6 no-print">
                    <h3 class="text-lg font-semibold text-amber-800 mb-4">üí∞ Estrategia de Precio</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <button id="btnMinimo" onclick="seleccionarEstrategia('minimo', 10)" class="estrategia-btn p-4 border-2 border-gray-300 rounded-xl text-center transition-all duration-300 hover:shadow-lg">
                            <div class="text-2xl mb-2">üíö</div>
                            <h4 class="font-semibold text-gray-700 mb-1">M√≠nimo no negociable</h4>
                            <p class="text-sm text-gray-600">+10% sobre costo base</p>
                            <p class="text-xs text-gray-500 mt-2">Precio de supervivencia</p>
                        </button>
                        <button id="btnRegular" onclick="seleccionarEstrategia('regular', 30)" class="estrategia-btn p-4 border-2 border-blue-300 bg-blue-50 rounded-xl text-center transition-all duration-300 hover:shadow-lg estrategia-activa">
                            <div class="text-2xl mb-2">üíô</div>
                            <h4 class="font-semibold text-blue-700 mb-1">Precio regular</h4>
                            <p class="text-sm text-blue-600">+30% sobre costo base</p>
                            <p class="text-xs text-blue-500 mt-2">Precio competitivo</p>
                        </button>
                        <button id="btnIdeal" onclick="seleccionarEstrategia('ideal', 130)" class="estrategia-btn p-4 border-2 border-purple-300 rounded-xl text-center transition-all duration-300 hover:shadow-lg">
                            <div class="text-2xl mb-2">üíú</div>
                            <h4 class="font-semibold text-gray-700 mb-1">Precio ideal</h4>
                            <p class="text-sm text-gray-600">+130% sobre costo base</p>
                            <p class="text-xs text-gray-500 mt-2">Precio premium</p>
                        </button>
                    </div>
                </div>

                <!-- Configuraci√≥n de Fechas -->
                <div class="mb-6 no-print">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-amber-700 mb-2">üìÖ Fecha de Emisi√≥n</label>
                            <input type="date" id="fechaEmisionInput" class="w-full p-3 border border-amber-200 rounded-lg focus:ring-2 focus:ring-amber-300" onchange="actualizarCotizacion()">
                            <p class="text-xs text-amber-600 mt-1">Fecha en que se genera la cotizaci√≥n</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-amber-700 mb-2">‚è∞ D√≠as de Validez (opcional)</label>
                            <input type="number" id="diasValidez" placeholder="30" min="1" class="w-full p-3 border border-amber-200 rounded-lg focus:ring-2 focus:ring-amber-300" onchange="actualizarCotizacion()">
                            <p class="text-xs text-amber-600 mt-1">D√≠as que la cotizaci√≥n permanece v√°lida</p>
                        </div>
                    </div>
                    <div id="fechaVencimiento" class="hidden p-3 bg-orange-50 border border-orange-200 rounded-lg">
                        <p class="text-sm text-orange-700">
                            <span class="font-semibold">‚ö†Ô∏è V√°lida hasta:</span> 
                            <span id="fechaVencimientoTexto" class="font-bold"></span>
                        </p>
                    </div>
                </div>

                <!-- Campo de Beneficios Clave -->
                <div class="mb-6 no-print">
                    <label class="block text-sm font-medium text-amber-700 mb-2">üí° Beneficios Clave (opcional)</label>
                    <textarea id="beneficiosClave" placeholder="Describe los beneficios principales de tus productos o servicios..." 
                              class="w-full p-3 border border-amber-200 rounded-lg focus:ring-2 focus:ring-amber-300 resize-none" 
                              rows="3" onchange="actualizarCotizacion()"></textarea>
                    <p class="text-xs text-amber-600 mt-1">Este texto aparecer√° en la cotizaci√≥n impresa</p>
                </div>

                <!-- Cotizaci√≥n -->
                <div id="cotizacionCompleta" class="space-y-6">
                    <!-- Encabezado de Cotizaci√≥n -->
                    <div class="text-center border-b-2 border-amber-200 pb-6">
                        <h1 class="text-3xl font-bold text-amber-900 mb-2 print-title">COTIZACI√ìN</h1>
                        <p class="text-amber-600">Fecha de emisi√≥n: <span id="fechaEmision"></span></p>
                        <p id="validezCotizacion" class="text-amber-600 hidden">V√°lida hasta: <span id="fechaValidez" class="font-semibold"></span></p>
                    </div>

                    <!-- Beneficios Clave (solo visible al imprimir si hay contenido) -->
                    <div id="beneficiosImpresos" class="hidden print-show bg-amber-50 p-4 rounded-lg">
                        <h3 class="font-semibold text-amber-800 mb-2">üí° Beneficios Clave:</h3>
                        <p id="textoBeneficios" class="text-amber-700"></p>
                    </div>

                    <!-- Lista de Productos/Servicios -->
                    <div>
                        <h3 class="text-lg font-semibold text-amber-800 mb-4">üì¶ Productos y Servicios</h3>
                        
                        <!-- Tabla de productos con an√°lisis detallado -->
                        <div class="overflow-x-auto">
                            <table class="w-full border-collapse">
                                <thead>
                                    <tr class="bg-amber-50">
                                        <th class="border border-amber-200 p-3 text-left text-amber-800 font-semibold">Producto/Servicio</th>
                                        <th class="border border-amber-200 p-3 text-center text-amber-800 font-semibold">Cantidad</th>
                                        <th class="border border-amber-200 p-3 text-right text-amber-800 font-semibold">Precio Unitario</th>
                                        <th class="border border-amber-200 p-3 text-right text-amber-800 font-semibold">Margen Contribuci√≥n</th>
                                        <th class="border border-amber-200 p-3 text-right text-amber-800 font-semibold">Subtotal</th>
                                    </tr>
                                </thead>
                                <tbody id="tablaProductosCotizacion">
                                    <!-- Se llenar√° din√°micamente -->
                                </tbody>
                            </table>
                        </div>

                        <!-- Totales -->
                        <div class="mt-6 flex justify-end">
                            <div class="w-full max-w-md">
                                <div class="bg-amber-50 p-4 rounded-lg border border-amber-200">
                                    <div class="flex justify-between items-center py-2 border-b border-amber-200">
                                        <span class="font-semibold text-amber-800">TOTAL GENERAL:</span>
                                        <span id="totalGeneralCotizacion" class="text-2xl font-bold text-amber-900"><span class="moneda">Q</span> 0</span>
                                    </div>
                                    <p class="text-sm text-amber-600 mt-2 italic">* Impuestos incluidos</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Informaci√≥n adicional (solo visible en pantalla) -->
                    <div class="no-print border-t border-amber-200 pt-6">
                        <h3 class="text-lg font-semibold text-amber-800 mb-3">üìä Informaci√≥n Adicional</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-green-50 p-4 rounded-lg text-center">
                                <p class="text-sm text-green-700">Ganancia Neta Total</p>
                                <p id="gananciaNetaCotizacion" class="text-xl font-bold text-green-800"><span class="moneda">Q</span> 0</p>
                            </div>
                            <div class="bg-blue-50 p-4 rounded-lg text-center">
                                <p class="text-sm text-blue-700">Margen Promedio</p>
                                <p id="margenPromedioCotizacion" class="text-xl font-bold text-blue-800">0%</p>
                            </div>
                            <div class="bg-purple-50 p-4 rounded-lg text-center">
                                <p class="text-sm text-purple-700">Total Impuestos</p>
                                <p id="totalImpuestosCotizacion" class="text-xl font-bold text-purple-800"><span class="moneda">Q</span> 0</p>
                            </div>
                        </div>
                    </div>

                    <!-- Resumen Completo (solo visible al imprimir resumen completo) -->
                    <div id="resumenCompleto" class="hidden print-show-complete">
                        <div class="border-t-2 border-amber-200 pt-6 mt-6">
                            <h3 class="text-xl font-bold text-amber-900 mb-4">üìã RESUMEN COMPLETO DE AN√ÅLISIS</h3>
                            
                            <!-- Estrategia de Precio -->
                            <div class="mb-6">
                                <h4 class="text-lg font-semibold text-amber-800 mb-2">üí∞ Estrategia de Precio Aplicada</h4>
                                <div class="bg-amber-50 p-4 rounded-lg">
                                    <p id="estrategiaSeleccionada" class="font-semibold text-amber-900">Precio regular (+30% sobre costo base)</p>
                                    <p class="text-sm text-amber-700 mt-1">Esta estrategia determina el margen de ganancia aplicado a todos los productos</p>
                                </div>
                            </div>

                            <!-- Impuestos Aplicados -->
                            <div class="mb-6">
                                <h4 class="text-lg font-semibold text-amber-800 mb-2">üè∑Ô∏è Impuestos Aplicados</h4>
                                <div id="impuestosAplicados" class="bg-red-50 p-4 rounded-lg">
                                    <p class="text-red-800">No se han configurado impuestos personalizados</p>
                                </div>
                            </div>

                            <!-- Informaci√≥n de Horas de Trabajo -->
                            <div class="mb-6">
                                <h4 class="text-lg font-semibold text-amber-800 mb-2">‚è∞ Planificaci√≥n de Horas de Trabajo</h4>
                                <div class="bg-orange-50 p-4 rounded-lg">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <p class="text-sm text-orange-700">Jornada laboral diaria:</p>
                                            <p id="horasDiariasPrint" class="font-semibold text-orange-900">No especificado</p>
                                        </div>
                                        <div>
                                            <p class="text-sm text-orange-700">D√≠as laborales por mes:</p>
                                            <p id="diasMensualesPrint" class="font-semibold text-orange-900">No especificado</p>
                                        </div>
                                        <div>
                                            <p class="text-sm text-orange-700">Horas totales del proyecto:</p>
                                            <p id="horasProyectoPrint" class="font-semibold text-orange-900">No especificado</p>
                                        </div>
                                        <div>
                                            <p class="text-sm text-orange-700">Honorarios por hora:</p>
                                            <p id="honorariosPrint" class="font-semibold text-orange-900">No especificado</p>
                                        </div>
                                    </div>
                                    <div class="mt-4 pt-4 border-t border-orange-200">
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <p class="text-sm text-orange-700">Total horas mensuales estimadas:</p>
                                                <p id="totalHorasMensualesPrint" class="text-lg font-bold text-orange-900">0 horas</p>
                                            </div>
                                            <div>
                                                <p class="text-sm text-orange-700">Costo total honorarios mensuales:</p>
                                                <p id="costoHonorariosPrint" class="text-lg font-bold text-orange-900"><span class="moneda">Q</span> 0</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- An√°lisis Financiero Detallado -->
                            <div class="mb-6">
                                <h4 class="text-lg font-semibold text-amber-800 mb-2">üìä An√°lisis Financiero Detallado</h4>
                                <div class="bg-blue-50 p-4 rounded-lg">
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div class="text-center">
                                            <p class="text-sm text-blue-700">Inversi√≥n Total Inicial</p>
                                            <p id="inversionTotalPrint" class="text-xl font-bold text-blue-900"><span class="moneda">Q</span> 0</p>
                                        </div>
                                        <div class="text-center">
                                            <p class="text-sm text-blue-700">Costos Fijos Mensuales</p>
                                            <p id="costosFijosPrint" class="text-xl font-bold text-blue-900"><span class="moneda">Q</span> 0</p>
                                        </div>
                                        <div class="text-center">
                                            <p class="text-sm text-blue-700">Punto de Equilibrio</p>
                                            <p id="puntoEquilibrioPrint" class="text-xl font-bold text-blue-900">0 unidades/mes</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Estilos para impresi√≥n -->
    <style media="print">
        /* Estilos para cotizaci√≥n b√°sica */
        @media print {
            body * { visibility: hidden; }
        }
        
        .print-cotizacion-basica {
            body * { visibility: hidden; }
            #cotizacionBasica, #cotizacionBasica * { visibility: visible; }
            #cotizacionBasica { 
                position: absolute; 
                left: 0; 
                top: 0; 
                width: 100%; 
                background: white;
                padding: 20px;
            }
            .no-print { display: none !important; }
            .print-show { display: block !important; }
            .print-title { font-size: 2rem !important; margin-bottom: 1rem !important; }
        }
        
        .print-resumen-completo {
            body * { visibility: hidden; }
            #cotizacionCompleta, #cotizacionCompleta * { visibility: visible; }
            #cotizacionCompleta { 
                position: absolute; 
                left: 0; 
                top: 0; 
                width: 100%; 
                background: white;
                padding: 20px;
            }
            .no-print { display: none !important; }
            .print-show { display: block !important; }
            .print-show-complete { display: block !important; }
            .print-title { font-size: 2rem !important; margin-bottom: 1rem !important; }
        }
        
        @page { margin: 1in; }
        
        /* Estilos espec√≠ficos para tabla en impresi√≥n */
        table { border-collapse: collapse !important; width: 100% !important; }
        th, td { border: 1px solid #d97706 !important; padding: 8px !important; }
        th { background-color: #fef3c7 !important; }
    </style>

    <script>
        let monedaActual = 'Q';
        let contadorProductos = 1;
        let impuestosPersonalizados = [];
        let estrategiaActual = 'regular';
        let porcentajeEstrategia = 30;

        function cambiarMoneda() {
            monedaActual = document.getElementById('monedaSelector').value;
            const elementos = document.querySelectorAll('.moneda');
            elementos.forEach(elemento => {
                elemento.textContent = monedaActual;
            });
        }

        function seleccionarEstrategia(tipo, porcentaje) {
            // Remover clase activa de todos los botones
            document.querySelectorAll('.estrategia-btn').forEach(btn => {
                btn.classList.remove('estrategia-activa');
                btn.classList.remove('bg-green-50', 'bg-blue-50', 'bg-purple-50');
                btn.classList.remove('border-green-300', 'border-blue-300', 'border-purple-300');
                btn.classList.add('border-gray-300');
                
                // Resetear colores de texto
                const h4 = btn.querySelector('h4');
                const p = btn.querySelector('p');
                const small = btn.querySelector('.text-xs');
                h4.classList.remove('text-green-700', 'text-blue-700', 'text-purple-700');
                p.classList.remove('text-green-600', 'text-blue-600', 'text-purple-600');
                small.classList.remove('text-green-500', 'text-blue-500', 'text-purple-500');
                h4.classList.add('text-gray-700');
                p.classList.add('text-gray-600');
                small.classList.add('text-gray-500');
            });

            // Activar el bot√≥n seleccionado
            const btnSeleccionado = document.getElementById(`btn${tipo.charAt(0).toUpperCase() + tipo.slice(1)}`);
            btnSeleccionado.classList.add('estrategia-activa');
            btnSeleccionado.classList.remove('border-gray-300');
            
            // Aplicar estilos espec√≠ficos seg√∫n el tipo
            const h4 = btnSeleccionado.querySelector('h4');
            const p = btnSeleccionado.querySelector('p');
            const small = btnSeleccionado.querySelector('.text-xs');
            
            h4.classList.remove('text-gray-700');
            p.classList.remove('text-gray-600');
            small.classList.remove('text-gray-500');
            
            if (tipo === 'minimo') {
                btnSeleccionado.classList.add('bg-green-50', 'border-green-300');
                h4.classList.add('text-green-700');
                p.classList.add('text-green-600');
                small.classList.add('text-green-500');
            } else if (tipo === 'regular') {
                btnSeleccionado.classList.add('bg-blue-50', 'border-blue-300');
                h4.classList.add('text-blue-700');
                p.classList.add('text-blue-600');
                small.classList.add('text-blue-500');
            } else if (tipo === 'ideal') {
                btnSeleccionado.classList.add('bg-purple-50', 'border-purple-300');
                h4.classList.add('text-purple-700');
                p.classList.add('text-purple-600');
                small.classList.add('text-purple-500');
            }

            // Actualizar variables globales
            estrategiaActual = tipo;
            porcentajeEstrategia = porcentaje;

            // Recalcular precios
            calcularProductos();
        }

        function toggleFormularioImpuestos() {
            const formulario = document.getElementById('formularioImpuestos');
            const boton = document.getElementById('toggleFormularioImpuestos');
            
            if (formulario.classList.contains('hidden')) {
                formulario.classList.remove('hidden');
                boton.innerHTML = 'Cancelar';
                boton.classList.remove('bg-success', 'hover-secondary');
                boton.classList.add('bg-accent', 'hover-warning');
            } else {
                formulario.classList.add('hidden');
                boton.innerHTML = '+ Agregar Impuesto';
                boton.classList.remove('bg-accent', 'hover-warning');
                boton.classList.add('bg-success', 'hover-secondary');
                // Limpiar campos al cerrar
                document.getElementById('nombreImpuestoPersonalizado').value = '';
                document.getElementById('porcentajeImpuestoPersonalizado').value = '';
            }
        }



        function agregarImpuestoPersonalizado() {
            const nombre = document.getElementById('nombreImpuestoPersonalizado').value.trim();
            const porcentaje = parseFloat(document.getElementById('porcentajeImpuestoPersonalizado').value);

            if (!nombre || isNaN(porcentaje) || porcentaje < 0) {
                alert('Por favor, ingresa un nombre v√°lido y un porcentaje mayor o igual a 0');
                return;
            }

            // Verificar si ya existe un impuesto con el mismo nombre
            if (impuestosPersonalizados.some(imp => imp.nombre.toLowerCase() === nombre.toLowerCase())) {
                alert('Ya existe un impuesto con ese nombre');
                return;
            }

            // Agregar el impuesto al array
            const nuevoImpuesto = {
                id: Date.now(),
                nombre: nombre,
                porcentaje: porcentaje
            };
            impuestosPersonalizados.push(nuevoImpuesto);

            // Actualizar la interfaz
            actualizarListaImpuestosPersonalizados();
            actualizarTotalImpuestosPersonalizados();

            // Limpiar campos y cerrar formulario
            document.getElementById('nombreImpuestoPersonalizado').value = '';
            document.getElementById('porcentajeImpuestoPersonalizado').value = '';
            toggleFormularioImpuestos();

            // Recalcular productos
            calcularProductos();
        }

        function eliminarImpuestoPersonalizado(id) {
            impuestosPersonalizados = impuestosPersonalizados.filter(imp => imp.id !== id);
            actualizarListaImpuestosPersonalizados();
            actualizarTotalImpuestosPersonalizados();
            calcularProductos();
        }

        function actualizarListaImpuestosPersonalizados() {
            const lista = document.getElementById('listaImpuestosPersonalizados');
            
            if (impuestosPersonalizados.length === 0) {
                lista.classList.add('hidden');
                return;
            }

            lista.classList.remove('hidden');

            lista.innerHTML = impuestosPersonalizados.map(impuesto => `
                <div class="flex justify-between items-center bg-white p-3 rounded-lg border border-amber-200">
                    <div class="flex items-center space-x-3">
                        <span class="text-2xl">üè∑Ô∏è</span>
                        <div>
                            <p class="font-semibold text-amber-800">${impuesto.nombre}</p>
                            <p class="text-sm text-amber-600">${impuesto.porcentaje}%</p>
                        </div>
                    </div>
                    <button onclick="eliminarImpuestoPersonalizado(${impuesto.id})" class="text-red-500 hover:text-red-700 p-2 rounded-lg hover:bg-red-50 transition-colors">
                        üóëÔ∏è
                    </button>
                </div>
            `).join('');
        }

        function actualizarTotalImpuestosPersonalizados() {
            const total = impuestosPersonalizados.reduce((sum, imp) => sum + imp.porcentaje, 0);
            document.getElementById('totalImpuestosPersonalizados').textContent = `${total.toFixed(1)}%`;
        }

        function calcularTotalImpuestosPersonalizados() {
            return impuestosPersonalizados.reduce((sum, imp) => sum + imp.porcentaje, 0);
        }

        function calcularHorasTrabajo() {
            // Calcular horas de trabajo para cada producto completo por separado
            const productosCompletos = document.querySelectorAll('.producto-completo');
            
            productosCompletos.forEach(producto => {
                const horasPorDia = parseFloat(producto.querySelector('.horas-por-dia')?.value) || 0;
                const diasPorMes = parseFloat(producto.querySelector('.dias-por-mes')?.value) || 0;
                const horasProyecto = parseFloat(producto.querySelector('.horas-proyecto')?.value) || 0;
                const honorariosHora = parseFloat(producto.querySelector('.honorarios-hora')?.value) || 0;

                const totalHorasMensuales = horasPorDia * diasPorMes;
                const costoHonorariosMensuales = totalHorasMensuales * honorariosHora;

                // Actualizar displays
                const totalHorasElement = producto.querySelector('.total-horas-mensuales');
                const costoHonorariosElement = producto.querySelector('.costo-honorarios-mensuales');
                
                if (totalHorasElement) {
                    totalHorasElement.textContent = `${totalHorasMensuales}`;
                }
                
                if (costoHonorariosElement) {
                    costoHonorariosElement.innerHTML = `<span class="moneda">${monedaActual}</span> ${costoHonorariosMensuales.toLocaleString()}`;
                }
            });

            // Recalcular costos para incluir honorarios
            calcularCostos();
        }

        function calcularInversion() {
            const items = document.querySelectorAll('#inversionItems input[type="number"]');
            let total = 0;
            items.forEach(item => {
                total += parseFloat(item.value) || 0;
            });
            document.getElementById('totalInversion').innerHTML = `<span class="moneda">${monedaActual}</span> ${total.toLocaleString()}`;
        }

        function agregarInversion(button) {
            const container = button.closest('.bg-gray-50').querySelector('.inversion-items');
            const div = document.createElement('div');
            div.className = 'flex gap-3 items-center';
            div.innerHTML = `
                <input type="text" placeholder="Concepto" class="flex-1 p-2 border border-success rounded-lg focus:ring-2 focus:ring-secondary text-sm">
                <div class="relative w-28">
                    <span class="absolute left-2 top-2 secondary-text font-semibold text-xs moneda">${monedaActual}</span>
                    <input type="number" placeholder="0" class="w-full pl-6 pr-2 py-2 border border-success rounded-lg focus:ring-2 focus:ring-secondary text-sm" onchange="calcularInversion()">
                </div>
                <button onclick="eliminarItem(this)" class="accent-text hover:bg-accent hover:text-white p-1 rounded transition-colors">üóëÔ∏è</button>
            `;
            container.appendChild(div);
        }

        function calcularCostos() {
            // Calcular costos fijos
            const fijos = document.querySelectorAll('#costosFijos input[type="number"]');
            let totalFijos = 0;
            fijos.forEach(item => {
                totalFijos += parseFloat(item.value) || 0;
            });
            document.getElementById('totalFijos').innerHTML = `<span class="moneda">${monedaActual}</span> ${totalFijos.toLocaleString()}`;

            // Calcular costos variables
            const variables = document.querySelectorAll('#costosVariables input[type="number"]');
            let totalVariables = 0;
            variables.forEach(item => {
                totalVariables += parseFloat(item.value) || 0;
            });
            document.getElementById('totalVariables').innerHTML = `<span class="moneda">${monedaActual}</span> ${totalVariables.toLocaleString()}`;

            // Actualizar punto de equilibrio
            document.getElementById('costosFijosEquilibrio').value = totalFijos;
            document.getElementById('costoVariableServicio').value = totalVariables;
            calcularProductos();
            calcularEquilibrio();
            actualizarResumen();
        }

        function agregarCostoFijo(button) {
            const container = button.closest('.mb-4').querySelector('.costos-fijos');
            const div = document.createElement('div');
            div.className = 'flex gap-2 items-center';
            div.innerHTML = `
                <input type="text" placeholder="Concepto" class="flex-1 p-2 border border-success rounded-lg focus:ring-2 focus:ring-secondary text-xs">
                <div class="relative w-20">
                    <span class="absolute left-1 top-2 secondary-text font-semibold text-xs moneda">${monedaActual}</span>
                    <input type="number" placeholder="0" class="w-full pl-4 pr-1 py-2 border border-success rounded-lg focus:ring-2 focus:ring-secondary text-xs" onchange="calcularCostos()">
                </div>
                <button onclick="eliminarItem(this)" class="accent-text hover:bg-accent hover:text-white text-xs p-1 rounded">üóëÔ∏è</button>
            `;
            container.appendChild(div);
        }

        function agregarCostoVariable(button) {
            const container = button.closest('.mb-4').querySelector('.costos-variables');
            const div = document.createElement('div');
            div.className = 'flex gap-2 items-center';
            div.innerHTML = `
                <input type="text" placeholder="Concepto" class="flex-1 p-2 border border-success rounded-lg focus:ring-2 focus:ring-secondary text-xs">
                <div class="relative w-20">
                    <span class="absolute left-1 top-2 secondary-text font-semibold text-xs moneda">${monedaActual}</span>
                    <input type="number" placeholder="0" class="w-full pl-4 pr-1 py-2 border border-success rounded-lg focus:ring-2 focus:ring-secondary text-xs" onchange="calcularCostos()">
                </div>
                <button onclick="eliminarItem(this)" class="accent-text hover:bg-accent hover:text-white text-xs p-1 rounded">üóëÔ∏è</button>
            `;
            container.appendChild(div);
        }

        function eliminarItem(button) {
            button.parentElement.remove();
            calcularInversion();
            calcularCostos();
        }

        function agregarProducto() {
            contadorProductos++;
            
            // Agregar nuevo producto a la secci√≥n de productos
            const container = document.getElementById('productosContainer');
            const div = document.createElement('div');
            div.className = 'border border-amber-200 rounded-xl p-6 producto-item';
            div.innerHTML = `
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-amber-800">üì¶ Producto ${contadorProductos}</h3>
                    <button onclick="eliminarProducto(this)" class="text-red-500 hover:text-red-700 p-2">üóëÔ∏è</button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-amber-700 mb-2">Nombre del producto</label>
                        <input type="text" placeholder="Ej: Producto nuevo" value="Producto ${contadorProductos}" class="w-full p-3 border border-amber-200 rounded-lg focus:ring-2 focus:ring-amber-300">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-amber-700 mb-2">Costo de producci√≥n</label>
                        <div class="relative">
                            <span class="absolute left-3 top-3 text-amber-600 font-semibold moneda">${monedaActual}</span>
                            <input type="number" placeholder="0" value="0" class="costo-produccion w-full pl-8 pr-3 py-3 border border-amber-200 rounded-lg focus:ring-2 focus:ring-amber-300 bg-gray-100" readonly>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-amber-700 mb-2">Precio de venta deseado</label>
                        <div class="relative">
                            <span class="absolute left-3 top-3 text-amber-600 font-semibold moneda">${monedaActual}</span>
                            <input type="number" placeholder="0" value="0" class="precio-venta w-full pl-8 pr-3 py-3 border border-amber-200 rounded-lg focus:ring-2 focus:ring-amber-300" onchange="calcularProductos()">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-amber-700 mb-2">Unidades producidas/mes</label>
                        <input type="number" placeholder="0" value="1" min="1" class="unidades-mensuales w-full p-3 border border-amber-200 rounded-lg focus:ring-2 focus:ring-amber-300" onchange="calcularProductos()">
                    </div>
                </div>
                
                <!-- Resultados del producto -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mt-4">
                    <div class="bg-blue-50 p-3 rounded-lg">
                        <p class="text-sm text-blue-700">Costo total (con fijos)</p>
                        <p class="costo-total text-lg font-bold text-blue-800"><span class="moneda">${monedaActual}</span> 0</p>
                    </div>
                    <div class="bg-red-50 p-3 rounded-lg">
                        <p class="text-sm text-red-700">Total impuestos</p>
                        <p class="total-impuestos text-lg font-bold text-red-800"><span class="moneda">${monedaActual}</span> 0</p>
                    </div>
                    <div class="bg-green-50 p-3 rounded-lg">
                        <p class="text-sm text-green-700">Ganancia neta</p>
                        <p class="ganancia-neta text-lg font-bold text-green-800"><span class="moneda">${monedaActual}</span> 0</p>
                    </div>
                    <div class="lavender-accent p-3 rounded-lg">
                        <p class="text-sm text-purple-700">Margen (%)</p>
                        <p class="margen-porcentaje text-lg font-bold text-purple-800">0%</p>
                    </div>
                </div>
            `;
            container.appendChild(div);

            // Agregar nueva secci√≥n de costos para este producto
            agregarSeccionCostosProducto(contadorProductos);
        }

        function agregarProductoCompleto() {
            contadorProductos++;
            
            const container = document.getElementById('productosCompletosContainer');
            const div = document.createElement('div');
            div.className = 'bg-white rounded-3xl p-8 border-2 border-success card-shadow';
            div.setAttribute('data-producto', contadorProductos);
            
            div.innerHTML = `
                <!-- Encabezado del Producto -->
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold primary-text mb-2">üì¶ PRODUCTO ${contadorProductos}</h2>
                    <p class="secondary-text text-lg">Configuraci√≥n completa: costos, precios y an√°lisis</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <!-- Inversi√≥n Inicial -->
                    <div class="bg-gray-50 rounded-2xl p-6 h-full">
                        <div class="flex items-center mb-4">
                            <span class="text-2xl mr-3">üí∞</span>
                            <div>
                                <h4 class="text-lg font-bold primary-text">Inversi√≥n Inicial</h4>
                                <p class="secondary-text text-sm">Gastos necesarios para arrancar</p>
                            </div>
                        </div>
                        
                        <div class="inversion-items space-y-3 mb-4">
                            <div class="flex gap-3 items-center">
                                <input type="text" placeholder="Concepto" value="Equipo espec√≠fico" class="flex-1 p-2 border border-success rounded-lg focus:ring-2 focus:ring-secondary text-sm">
                                <div class="relative w-28">
                                    <span class="absolute left-2 top-2 secondary-text font-semibold text-xs moneda">${monedaActual}</span>
                                    <input type="number" placeholder="0" value="0" class="w-full pl-6 pr-2 py-2 border border-success rounded-lg focus:ring-2 focus:ring-secondary text-sm" onchange="calcularInversion()">
                                </div>
                                <button onclick="eliminarItem(this)" class="accent-text hover:bg-accent hover:text-white p-1 rounded transition-colors">üóëÔ∏è</button>
                            </div>
                        </div>
                        
                        <button onclick="agregarInversion(this)" class="w-full p-2 bg-success text-white rounded-lg hover-secondary transition-colors mb-3 font-medium text-sm">
                            + Agregar costo inicial
                        </button>
                        
                        <div class="dark-gradient text-white p-3 rounded-lg text-center">
                            <p class="text-sm font-semibold">Total Inversi√≥n</p>
                            <p class="total-inversion text-xl font-bold"><span class="moneda">${monedaActual}</span> 0</p>
                        </div>
                    </div>

                    <!-- Costos Mensuales -->
                    <div class="bg-gray-50 rounded-2xl p-6 h-full">
                        <div class="flex items-center mb-4">
                            <span class="text-2xl mr-3">üìä</span>
                            <div>
                                <h4 class="text-lg font-bold primary-text">Costos Mensuales</h4>
                                <p class="secondary-text text-sm">Gastos fijos y variables</p>
                            </div>
                        </div>

                        <!-- Costos Fijos -->
                        <div class="mb-4">
                            <h5 class="text-sm font-semibold secondary-text mb-2">Costos Fijos</h5>
                            <div class="costos-fijos space-y-2 mb-3">
                                <div class="flex gap-2 items-center">
                                    <input type="text" placeholder="Concepto" value="Costo espec√≠fico" class="flex-1 p-2 border border-success rounded-lg focus:ring-2 focus:ring-secondary text-xs">
                                    <div class="relative w-20">
                                        <span class="absolute left-1 top-2 secondary-text font-semibold text-xs moneda">${monedaActual}</span>
                                        <input type="number" placeholder="0" value="0" class="w-full pl-4 pr-1 py-2 border border-success rounded-lg focus:ring-2 focus:ring-secondary text-xs" onchange="calcularCostos()">
                                    </div>
                                    <button onclick="eliminarItem(this)" class="accent-text hover:bg-accent hover:text-white text-xs p-1 rounded">üóëÔ∏è</button>
                                </div>
                            </div>
                            <button onclick="agregarCostoFijo(this)" class="w-full p-2 bg-blue-100 text-blue-800 rounded-lg hover:bg-blue-200 transition-colors text-xs mb-2">+ Agregar fijo</button>
                            <div class="p-2 bg-blue-50 rounded-lg">
                                <p class="font-semibold text-blue-800 text-xs">Total Fijos: <span class="total-fijos"><span class="moneda">${monedaActual}</span> 0</span></p>
                            </div>
                        </div>

                        <!-- Costos Variables -->
                        <div class="mb-4">
                            <h5 class="text-sm font-semibold secondary-text mb-2">Costos Variables</h5>
                            <div class="costos-variables space-y-2 mb-3">
                                <div class="flex gap-2 items-center">
                                    <input type="text" placeholder="Concepto" value="Material espec√≠fico" class="flex-1 p-2 border border-success rounded-lg focus:ring-2 focus:ring-secondary text-xs">
                                    <div class="relative w-20">
                                        <span class="absolute left-1 top-2 secondary-text font-semibold text-xs moneda">${monedaActual}</span>
                                        <input type="number" placeholder="0" value="0" class="w-full pl-4 pr-1 py-2 border border-success rounded-lg focus:ring-2 focus:ring-secondary text-xs" onchange="calcularCostos()">
                                    </div>
                                    <button onclick="eliminarItem(this)" class="accent-text hover:bg-accent hover:text-white text-xs p-1 rounded">üóëÔ∏è</button>
                                </div>
                            </div>
                            <button onclick="agregarCostoVariable(this)" class="w-full p-2 bg-purple-100 text-purple-800 rounded-lg hover:bg-purple-200 transition-colors text-xs mb-2">+ Agregar variable</button>
                            <div class="p-2 bg-purple-50 rounded-lg">
                                <p class="font-semibold text-purple-800 text-xs">Total Variables: <span class="total-variables"><span class="moneda">${monedaActual}</span> 0</span></p>
                            </div>
                        </div>

                        <!-- Horas de Trabajo -->
                        <div class="border-t border-gray-300 pt-4">
                            <h5 class="text-sm font-semibold secondary-text mb-2">‚è∞ Horas de Trabajo</h5>
                            <div class="grid grid-cols-2 gap-2 mb-3">
                                <div>
                                    <input type="number" placeholder="Horas/d√≠a" min="1" max="24" class="horas-por-dia w-full p-2 border border-success rounded-lg focus:ring-2 focus:ring-secondary text-xs" onchange="calcularHorasTrabajo()">
                                </div>
                                <div>
                                    <input type="number" placeholder="D√≠as/mes" min="1" max="31" class="dias-por-mes w-full p-2 border border-success rounded-lg focus:ring-2 focus:ring-secondary text-xs" onchange="calcularHorasTrabajo()">
                                </div>
                                <div>
                                    <input type="number" placeholder="Horas proyecto" min="1" class="horas-proyecto w-full p-2 border border-success rounded-lg focus:ring-2 focus:ring-secondary text-xs" onchange="calcularHorasTrabajo()">
                                </div>
                                <div class="relative">
                                    <span class="absolute left-1 top-2 secondary-text font-semibold text-xs moneda">${monedaActual}</span>
                                    <input type="number" placeholder="Honorarios/h" min="0" class="honorarios-hora w-full pl-4 pr-1 py-2 border border-success rounded-lg focus:ring-2 focus:ring-secondary text-xs" onchange="calcularHorasTrabajo()">
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-2">
                                <div class="bg-orange-50 p-2 rounded-lg text-center">
                                    <p class="text-xs text-orange-700">Horas/mes</p>
                                    <p class="total-horas-mensuales text-sm font-bold text-orange-800">0</p>
                                </div>
                                <div class="bg-green-50 p-2 rounded-lg text-center">
                                    <p class="text-xs text-green-700">Honorarios</p>
                                    <p class="costo-honorarios-mensuales text-sm font-bold text-green-800"><span class="moneda">${monedaActual}</span> 0</p>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Configuraci√≥n del Producto -->
            <div class="bg-gray-50 rounded-2xl p-6 mb-8">
                <div class="flex items-center mb-4">
                    <span class="text-2xl mr-3">üõçÔ∏è</span>
                    <div>
                        <h4 class="text-lg font-bold primary-text">Configuraci√≥n</h4>
                        <p class="secondary-text text-sm">Precio y producci√≥n</p>
                    </div>
                </div>
                
                <div class="space-y-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium secondary-text mb-2">Nombre del producto</label>
                        <input type="text" placeholder="Ej: Producto nuevo" value="Producto ${contadorProductos}" class="w-full p-3 border border-success rounded-lg focus:ring-2 focus:ring-secondary">
                    </div>
                    <div>
                        <label class="block text-sm font-medium secondary-text mb-2">Costo de producci√≥n</label>
                        <div class="relative">
                            <span class="absolute left-3 top-3 secondary-text font-semibold moneda">${monedaActual}</span>
                            <input type="number" placeholder="0" value="0" class="costo-produccion w-full pl-8 pr-3 py-3 border border-success rounded-lg focus:ring-2 focus:ring-secondary bg-gray-100" readonly>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium secondary-text mb-2">Precio de venta deseado</label>
                        <div class="relative">
                            <span class="absolute left-3 top-3 secondary-text font-semibold moneda">${monedaActual}</span>
                            <input type="number" placeholder="0" value="0" class="precio-venta w-full pl-8 pr-3 py-3 border border-success rounded-lg focus:ring-2 focus:ring-secondary" onchange="calcularProductos()">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium secondary-text mb-2">Unidades producidas/mes</label>
                        <input type="number" placeholder="0" value="1" min="1" class="unidades-mensuales w-full p-3 border border-success rounded-lg focus:ring-2 focus:ring-secondary" onchange="calcularProductos()">
                    </div>
                </div>
            </div>
            
            <!-- Resultados del producto -->
            <div class="grid grid-cols-4 gap-3 mt-8">
                <div class="bg-blue-50 p-3 rounded-lg text-center">
                    <p class="text-xs text-blue-700">Costo total</p>
                    <p class="costo-total text-sm font-bold text-blue-800"><span class="moneda">${monedaActual}</span> 0</p>
                </div>
                <div class="bg-red-50 p-3 rounded-lg text-center">
                    <p class="text-xs text-red-700">Impuestos</p>
                    <p class="total-impuestos text-sm font-bold text-red-800"><span class="moneda">${monedaActual}</span> 0</p>
                </div>
                <div class="bg-green-50 p-3 rounded-lg text-center">
                    <p class="text-xs text-green-700">Ganancia</p>
                    <p class="ganancia-neta text-sm font-bold text-green-800"><span class="moneda">${monedaActual}</span> 0</p>
                </div>
                <div class="bg-purple-50 p-3 rounded-lg text-center">
                    <p class="text-xs text-purple-700">Margen</p>
                    <p class="margen-porcentaje text-sm font-bold text-purple-800">0%</p>
                </div>
            </div>

            `;
            
            container.appendChild(div);
            calcularProductos();
        }

        function eliminarProductoCompleto(button) {
            const productoCompleto = button.closest('.producto-completo');
            const numeroProducto = productoCompleto.getAttribute('data-producto');
            
            // Proteger el Producto 1 - no se puede eliminar
            if (numeroProducto === '1') {
                alert('‚ö†Ô∏è El Producto 1 no se puede eliminar. Es la base m√≠nima de tu calculadora.');
                return;
            }
            
            // Eliminar el producto completo del DOM directamente
            productoCompleto.remove();
            
            // Recalcular todos los valores despu√©s de la eliminaci√≥n
            calcularInversion();
            calcularCostos();
            calcularProductos();
            calcularEquilibrio();
            actualizarCotizacion();
        }

        function calcularInversion() {
            // Calcular inversi√≥n para el producto base
            const productoBase = document.querySelector('.bg-white.rounded-3xl.p-8.border-2.border-success.card-shadow.mb-8');
            if (productoBase) {
                const items = productoBase.querySelectorAll('.inversion-items input[type="number"]');
                let total = 0;
                items.forEach(item => {
                    total += parseFloat(item.value) || 0;
                });
                const totalElement = productoBase.querySelector('.total-inversion');
                if (totalElement) {
                    totalElement.innerHTML = `<span class="moneda">${monedaActual}</span> ${total.toLocaleString()}`;
                }
            }

            // Calcular inversi√≥n para productos adicionales
            const productosAdicionales = document.querySelectorAll('#productosCompletosContainer > div');
            productosAdicionales.forEach(producto => {
                const items = producto.querySelectorAll('.inversion-items input[type="number"]');
                let total = 0;
                items.forEach(item => {
                    total += parseFloat(item.value) || 0;
                });
                const totalElement = producto.querySelector('.total-inversion');
                if (totalElement) {
                    totalElement.innerHTML = `<span class="moneda">${monedaActual}</span> ${total.toLocaleString()}`;
                }
            });
            
            calcularProductos();
        }

        function calcularCostos() {
            // Calcular costos para el producto base
            const productoBase = document.querySelector('.bg-white.rounded-3xl.p-8.border-2.border-success.card-shadow.mb-8');
            if (productoBase) {
                // Calcular costos fijos
                const fijos = productoBase.querySelectorAll('.costos-fijos input[type="number"]');
                let totalFijos = 0;
                fijos.forEach(item => {
                    totalFijos += parseFloat(item.value) || 0;
                });

                // Agregar honorarios mensuales a costos fijos si est√°n definidos
                const horasPorDia = parseFloat(productoBase.querySelector('.horas-por-dia')?.value) || 0;
                const diasPorMes = parseFloat(productoBase.querySelector('.dias-por-mes')?.value) || 0;
                const honorariosHora = parseFloat(productoBase.querySelector('.honorarios-hora')?.value) || 0;
                const honorariosMensuales = horasPorDia * diasPorMes * honorariosHora;
                
                totalFijos += honorariosMensuales;

                const totalFijosElement = productoBase.querySelector('.total-fijos');
                if (totalFijosElement) {
                    totalFijosElement.innerHTML = `<span class="moneda">${monedaActual}</span> ${totalFijos.toLocaleString()}`;
                }

                // Calcular costos variables
                const variables = productoBase.querySelectorAll('.costos-variables input[type="number"]');
                let totalVariables = 0;
                variables.forEach(item => {
                    totalVariables += parseFloat(item.value) || 0;
                });
                const totalVariablesElement = productoBase.querySelector('.total-variables');
                if (totalVariablesElement) {
                    totalVariablesElement.innerHTML = `<span class="moneda">${monedaActual}</span> ${totalVariables.toLocaleString()}`;
                }
            }

            // Calcular costos para productos adicionales
            const productosAdicionales = document.querySelectorAll('#productosCompletosContainer > div');
            productosAdicionales.forEach(producto => {
                // Calcular costos fijos
                const fijos = producto.querySelectorAll('.costos-fijos input[type="number"]');
                let totalFijos = 0;
                fijos.forEach(item => {
                    totalFijos += parseFloat(item.value) || 0;
                });

                // Agregar honorarios mensuales a costos fijos si est√°n definidos
                const horasPorDia = parseFloat(producto.querySelector('.horas-por-dia')?.value) || 0;
                const diasPorMes = parseFloat(producto.querySelector('.dias-por-mes')?.value) || 0;
                const honorariosHora = parseFloat(producto.querySelector('.honorarios-hora')?.value) || 0;
                const honorariosMensuales = horasPorDia * diasPorMes * honorariosHora;
                
                totalFijos += honorariosMensuales;

                const totalFijosElement = producto.querySelector('.total-fijos');
                if (totalFijosElement) {
                    totalFijosElement.innerHTML = `<span class="moneda">${monedaActual}</span> ${totalFijos.toLocaleString()}`;
                }

                // Calcular costos variables
                const variables = producto.querySelectorAll('.costos-variables input[type="number"]');
                let totalVariables = 0;
                variables.forEach(item => {
                    totalVariables += parseFloat(item.value) || 0;
                });
                const totalVariablesElement = producto.querySelector('.total-variables');
                if (totalVariablesElement) {
                    totalVariablesElement.innerHTML = `<span class="moneda">${monedaActual}</span> ${totalVariables.toLocaleString()}`;
                }
            });

            calcularProductos();
            calcularEquilibrio();
            actualizarCotizacion();
        }

        function calcularProductos() {
            // Obtener todos los productos (base + adicionales)
            const productoBase = document.querySelector('.bg-white.rounded-3xl.p-8.border-2.border-success.card-shadow.mb-8');
            const productosAdicionales = document.querySelectorAll('#productosCompletosContainer > div');
            const todosLosProductos = [];
            
            if (productoBase) todosLosProductos.push(productoBase);
            productosAdicionales.forEach(producto => todosLosProductos.push(producto));
            
            const impuestosPersonalizadosRate = calcularTotalImpuestosPersonalizados();

            todosLosProductos.forEach((producto, index) => {
                const precioVenta = parseFloat(producto.querySelector('.precio-venta').value) || 0;
                const unidadesMensuales = parseFloat(producto.querySelector('.unidades-mensuales').value) || 0;

                // Obtener costos espec√≠ficos de este producto
                let totalFijos = 0;
                let totalVariables = 0;
                let inversionInicial = 0;

                // Calcular inversi√≥n inicial de este producto
                const inversionItems = producto.querySelectorAll('.inversion-items input[type="number"]');
                inversionItems.forEach(item => {
                    inversionInicial += parseFloat(item.value) || 0;
                });

                // Calcular costos fijos de este producto (incluyendo honorarios)
                const fijos = producto.querySelectorAll('.costos-fijos input[type="number"]');
                fijos.forEach(item => {
                    totalFijos += parseFloat(item.value) || 0;
                });

                // Agregar honorarios mensuales a costos fijos si est√°n definidos
                const horasPorDia = parseFloat(producto.querySelector('.horas-por-dia')?.value) || 0;
                const diasPorMes = parseFloat(producto.querySelector('.dias-por-mes')?.value) || 0;
                const honorariosHora = parseFloat(producto.querySelector('.honorarios-hora')?.value) || 0;
                const honorariosMensuales = horasPorDia * diasPorMes * honorariosHora;
                totalFijos += honorariosMensuales;

                // Calcular costos variables de este producto
                const variables = producto.querySelectorAll('.costos-variables input[type="number"]');
                variables.forEach(item => {
                    totalVariables += parseFloat(item.value) || 0;
                });

                // Calcular costo de producci√≥n autom√°ticamente para este producto espec√≠fico
                const amortizacionMensual = inversionInicial / 12;
                const costoFijosPorUnidad = unidadesMensuales > 0 ? (totalFijos + amortizacionMensual) / unidadesMensuales : 0;
                const costoVariablesPorUnidad = totalVariables;
                
                const costoProduccionCalculado = costoFijosPorUnidad + costoVariablesPorUnidad;
                
                // Actualizar el campo de costo de producci√≥n
                producto.querySelector('.costo-produccion').value = Math.round(costoProduccionCalculado);

                const costoTotal = costoProduccionCalculado;

                // Calcular precio con estrategia seleccionada
                const precioConEstrategia = costoTotal * (1 + porcentajeEstrategia / 100);
                
                // Solo actualizar el precio si est√° en 0 o vac√≠o (para sugerencia inicial)
                const campoPrecios = producto.querySelector('.precio-venta');
                const precioActual = parseFloat(campoPrecios.value) || 0;
                if (precioActual === 0) {
                    campoPrecios.value = Math.round(precioConEstrategia);
                    campoPrecios.placeholder = Math.round(precioConEstrategia);
                } else {
                    // Usar el precio ingresado por el usuario
                    campoPrecios.placeholder = Math.round(precioConEstrategia);
                }
                
                const precioVentaFinal = precioActual > 0 ? precioActual : precioConEstrategia;

                // Calcular impuestos totales sobre el precio final
                const totalImpuestos = (precioVentaFinal * impuestosPersonalizadosRate) / 100;

                // Calcular ganancia
                const gananciaNeta = precioVentaFinal - costoTotal - totalImpuestos;
                const margenPorcentaje = precioVentaFinal > 0 ? (gananciaNeta / precioVentaFinal) * 100 : 0;

                // Actualizar elementos del producto
                producto.querySelector('.costo-total').innerHTML = `<span class="moneda">${monedaActual}</span> ${costoTotal.toFixed(2)}`;
                producto.querySelector('.total-impuestos').innerHTML = `<span class="moneda">${monedaActual}</span> ${totalImpuestos.toFixed(2)}`;
                producto.querySelector('.ganancia-neta').innerHTML = `<span class="moneda">${monedaActual}</span> ${gananciaNeta.toFixed(2)}`;
                producto.querySelector('.margen-porcentaje').textContent = `${margenPorcentaje.toFixed(1)}%`;
            });

            calcularEquilibrio();
            actualizarCotizacion();
        }

        function calcularEquilibrio() {
            // Obtener todos los productos (base + adicionales)
            const productoBase = document.querySelector('.bg-white.rounded-3xl.p-8.border-2.border-success.card-shadow.mb-8');
            const productosAdicionales = document.querySelectorAll('#productosCompletosContainer > div');
            const todosLosProductos = [];
            
            if (productoBase) todosLosProductos.push(productoBase);
            productosAdicionales.forEach(producto => todosLosProductos.push(producto));

            let totalFijosGlobal = 0;
            let totalInversionGlobal = 0;
            let totalIngresos = 0;
            let totalUnidades = 0;
            let totalCostosVariablesPuros = 0;

            todosLosProductos.forEach(producto => {
                // Sumar costos fijos espec√≠ficos de cada producto
                const fijos = producto.querySelectorAll('.costos-fijos input[type="number"]');
                fijos.forEach(item => {
                    totalFijosGlobal += parseFloat(item.value) || 0;
                });

                // Sumar honorarios mensuales de cada producto
                const horasPorDia = parseFloat(producto.querySelector('.horas-por-dia')?.value) || 0;
                const diasPorMes = parseFloat(producto.querySelector('.dias-por-mes')?.value) || 0;
                const honorariosHora = parseFloat(producto.querySelector('.honorarios-hora')?.value) || 0;
                const honorariosMensuales = horasPorDia * diasPorMes * honorariosHora;
                totalFijosGlobal += honorariosMensuales;

                // Sumar inversi√≥n inicial de cada producto
                const inversionItems = producto.querySelectorAll('.inversion-items input[type="number"]');
                inversionItems.forEach(item => {
                    totalInversionGlobal += parseFloat(item.value) || 0;
                });

                // Obtener datos del producto para c√°lculos
                const precio = parseFloat(producto.querySelector('.precio-venta').value) || 0;
                const unidades = parseFloat(producto.querySelector('.unidades-mensuales').value) || 0;
                
                // Calcular costos variables puros (sin incluir fijos distribuidos)
                const costosVariables = producto.querySelectorAll('.costos-variables input[type="number"]');
                let costosVariablesProducto = 0;
                costosVariables.forEach(item => {
                    costosVariablesProducto += parseFloat(item.value) || 0;
                });
                
                totalIngresos += precio * unidades;
                totalUnidades += unidades;
                totalCostosVariablesPuros += costosVariablesProducto * unidades;
            });

            // Calcular amortizaci√≥n mensual de todas las inversiones
            const amortizacionMensual = totalInversionGlobal / 12;
            const costosFijosTotales = totalFijosGlobal + amortizacionMensual;

            // Calcular promedios ponderados
            const precioPromedio = totalUnidades > 0 ? totalIngresos / totalUnidades : 0;
            const costoVariablePromedio = totalUnidades > 0 ? totalCostosVariablesPuros / totalUnidades : 0;

            // Actualizar displays con informaci√≥n completa
            document.getElementById('costosFijosEquilibrioDisplay').textContent = Math.round(costosFijosTotales).toLocaleString();
            document.getElementById('precioPromedioServicioDisplay').textContent = Math.round(precioPromedio).toLocaleString();
            document.getElementById('costoVariableServicioDisplay').textContent = Math.round(costoVariablePromedio).toLocaleString();

            // Calcular punto de equilibrio
            const margenContribucion = precioPromedio - costoVariablePromedio;
            const unidadesNecesarias = margenContribucion > 0 ? costosFijosTotales / margenContribucion : 0;
            const ingresosMinimos = unidadesNecesarias * precioPromedio;

            document.getElementById('margenContribucion').innerHTML = `<span class="moneda">${monedaActual}</span> ${Math.round(margenContribucion).toLocaleString()}`;
            document.getElementById('serviciosEquilibrio').textContent = `${Math.ceil(unidadesNecesarias)} unidades/mes`;
            document.getElementById('ingresosMinimos').innerHTML = `<span class="moneda">${monedaActual}</span> ${Math.round(ingresosMinimos).toLocaleString()}`;


        }





        function actualizarCotizacion() {
            // Actualizar fecha de emisi√≥n
            const fechaInput = document.getElementById('fechaEmisionInput');
            const diasValidez = parseInt(document.getElementById('diasValidez').value);
            
            let fechaEmision;
            if (fechaInput.value) {
                fechaEmision = new Date(fechaInput.value + 'T00:00:00');
            } else {
                fechaEmision = new Date();
                fechaInput.value = fechaEmision.toISOString().split('T')[0];
            }
            
            const fechaFormateada = fechaEmision.toLocaleDateString('es-ES', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('fechaEmision').textContent = fechaFormateada;

            // Calcular y mostrar fecha de vencimiento
            const fechaVencimientoDiv = document.getElementById('fechaVencimiento');
            const validezCotizacionP = document.getElementById('validezCotizacion');
            
            if (diasValidez && diasValidez > 0) {
                const fechaVencimiento = new Date(fechaEmision);
                fechaVencimiento.setDate(fechaVencimiento.getDate() + diasValidez);
                
                const fechaVencimientoFormateada = fechaVencimiento.toLocaleDateString('es-ES', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                // Mostrar en la secci√≥n de configuraci√≥n
                document.getElementById('fechaVencimientoTexto').textContent = fechaVencimientoFormateada;
                fechaVencimientoDiv.classList.remove('hidden');
                
                // Mostrar en la cotizaci√≥n impresa
                document.getElementById('fechaValidez').textContent = fechaVencimientoFormateada;
                validezCotizacionP.classList.remove('hidden');
            } else {
                fechaVencimientoDiv.classList.add('hidden');
                validezCotizacionP.classList.add('hidden');
            }

            // Actualizar beneficios clave
            const beneficios = document.getElementById('beneficiosClave').value.trim();
            const beneficiosDiv = document.getElementById('beneficiosImpresos');
            const textoBeneficios = document.getElementById('textoBeneficios');
            
            if (beneficios) {
                beneficiosDiv.classList.remove('hidden');
                beneficiosDiv.classList.add('print-show');
                textoBeneficios.textContent = beneficios;
            } else {
                beneficiosDiv.classList.add('hidden');
                beneficiosDiv.classList.remove('print-show');
            }

            // Actualizar tabla de productos
            const productosCompletos = document.querySelectorAll('.producto-completo');
            const tabla = document.getElementById('tablaProductosCotizacion');
            
            let totalGeneral = 0;
            let totalGananciaNeta = 0;
            let totalImpuestos = 0;
            let totalMargen = 0;
            let contadorProductos = 0;

            if (productosCompletos.length === 0) {
                tabla.innerHTML = '<tr><td colspan="5" class="border border-amber-200 p-4 text-center text-amber-600 italic">No hay productos configurados</td></tr>';
            } else {
                tabla.innerHTML = Array.from(productosCompletos).map(producto => {
                    const nombre = producto.querySelector('input[type="text"]').value || 'Sin nombre';
                    const precio = parseFloat(producto.querySelector('.precio-venta').value) || 0;
                    const unidades = parseFloat(producto.querySelector('.unidades-mensuales').value) || 0;
                    const costoProduccion = parseFloat(producto.querySelector('.costo-produccion').value) || 0;
                    const margenContribucion = precio - costoProduccion;
                    const subtotal = precio * unidades;
                    
                    // Obtener datos para resumen
                    const gananciaNeta = parseFloat(producto.querySelector('.ganancia-neta').textContent.replace(/[^\d.-]/g, '')) || 0;
                    const impuestosProducto = parseFloat(producto.querySelector('.total-impuestos').textContent.replace(/[^\d.-]/g, '')) || 0;
                    const margenTexto = producto.querySelector('.margen-porcentaje').textContent;
                    const margenNumero = parseFloat(margenTexto.replace('%', '')) || 0;
                    
                    totalGeneral += subtotal;
                    totalGananciaNeta += gananciaNeta * unidades;
                    totalImpuestos += impuestosProducto * unidades;
                    totalMargen += margenNumero;
                    contadorProductos++;
                    
                    return `
                        <tr>
                            <td class="border border-amber-200 p-3">${nombre}</td>
                            <td class="border border-amber-200 p-3 text-center">${unidades}</td>
                            <td class="border border-amber-200 p-3 text-right"><span class="moneda">${monedaActual}</span> ${precio.toLocaleString()}</td>
                            <td class="border border-amber-200 p-3 text-right"><span class="moneda">${monedaActual}</span> ${Math.round(margenContribucion).toLocaleString()}</td>
                            <td class="border border-amber-200 p-3 text-right font-semibold"><span class="moneda">${monedaActual}</span> ${subtotal.toLocaleString()}</td>
                        </tr>
                    `;
                }).join('');
            }

            // Actualizar totales
            document.getElementById('totalGeneralCotizacion').innerHTML = `<span class="moneda">${monedaActual}</span> ${totalGeneral.toLocaleString()}`;
            document.getElementById('gananciaNetaCotizacion').innerHTML = `<span class="moneda">${monedaActual}</span> ${Math.round(totalGananciaNeta).toLocaleString()}`;
            document.getElementById('totalImpuestosCotizacion').innerHTML = `<span class="moneda">${monedaActual}</span> ${Math.round(totalImpuestos).toLocaleString()}`;
            
            const margenPromedio = contadorProductos > 0 ? totalMargen / contadorProductos : 0;
            document.getElementById('margenPromedioCotizacion').textContent = `${margenPromedio.toFixed(1)}%`;
        }

        function imprimirCotizacion() {
            actualizarCotizacion();
            
            // Ocultar el resumen completo para impresi√≥n b√°sica
            const resumenCompleto = document.getElementById('resumenCompleto');
            resumenCompleto.classList.add('hidden');
            
            // Crear estilos espec√≠ficos para cotizaci√≥n b√°sica
            const style = document.createElement('style');
            style.innerHTML = `
                @media print {
                    body * { visibility: hidden; }
                    #cotizacionCompleta, #cotizacionCompleta * { 
                        visibility: visible; 
                    }
                    #cotizacionCompleta { 
                        position: absolute; 
                        left: 0; 
                        top: 0; 
                        width: 100%; 
                        background: white;
                        padding: 20px;
                    }
                    .no-print { display: none !important; }
                    .print-show { display: block !important; }
                    #resumenCompleto { display: none !important; }
                    .print-title { font-size: 2rem !important; margin-bottom: 1rem !important; }
                    table { border-collapse: collapse !important; width: 100% !important; }
                    th, td { border: 1px solid #d97706 !important; padding: 8px !important; }
                    th { background-color: #fef3c7 !important; }
                }
            `;
            document.head.appendChild(style);
            
            window.print();
            
            // Limpiar despu√©s de imprimir
            setTimeout(() => {
                document.head.removeChild(style);
            }, 1000);
        }

        // Inicializar c√°lculos
        calcularInversion();
        calcularCostos();
        calcularProductos();
        calcularEquilibrio();
        calcularHorasTrabajo();
        actualizarListaImpuestosPersonalizados();
        actualizarTotalImpuestosPersonalizados();
        actualizarCotizacion();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9812fd60b547c82c',t:'MTc1ODIyMTAxNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
